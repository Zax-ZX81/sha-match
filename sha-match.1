.\" Generated by pandoc and edited by hand.
.TH SHA-MATCH "1" "November 2020" "sha-match 0.32" "User Commands"
.SH NAME
sha-match \- a simple system for cataloguing and managing files using SHA256
.SH SYNOPSIS
.B smatch
[\fI\,dimV\/\fR] \fI\,searchlist\/\fR
\fI\,database\/\fR
.PP
.B sfind
[\fI\,fiopsuvVx\/\fR] \fI\,dataset\/\fR
.PP
.B scheck
[\fI\,V\/\fR] \fI\,search-file\/\fR
[\fI\,\-d database-file\/\fR]
.PP
.B sconvert
\fISHA256file\fR
.SH DESCRIPTION
\fBsha-match\fR uses SHA256 checksums to identify files, cataloguing
collections of files (\fIdatasets\fR) for later searches.
\fIDataset\fR files can be compared to show files in common, or files
unique to one set.
.SS smatch
Compares two dataset files \- a \fIsearchlist\fR and a
\fIdatabase\fR, printing the filepaths of matching files from the
\fIsearchlist\fR to \fIstdout\fR.
\fB-d\fR and \fB-m\fR can be used in combination, \fB-i\fR
is exclusive.
.PP
.TP
.B \fB-d\fR
Print matches from the \fIdatabase\fR.
.PP
.TP
.B \fB-i\fR
Print the complement of the search - the files that \fBdon\[cq]t\fR
match.
This output is the full two or three field entries for the files from the \fIdatabase\fR
dataset.
.PP
.TP
.B \fB-m\fR
Print all matches for a file if there are multiples.
.PP
.TP
.B \fB-V\fR
Print version information.
.SS sfind
This generates a dataset for the current directory, equivalent to 'find
-type f | sha256sum > dataset.sha256'.
The default output is a s2db file, but output matching
\fIsha256sum\fR is available.
.PP
.TP
.B \fB-f\fR
Sort file by filepath.
Default is to sort by \fISHA256\fR.
.PP
.TP
.B \fB-i\fR
\fBInclude\fR only entries in 'sf_filter' in file search.
.PP
.TP
.B \fB-o\fR
Create two column \fIsha256sum\fR output.
.PP
.TP
.B \fB-p\fR
Show progress in SHA256 generation phase.
.PP
.TP
.B \fB-s\fR
Suppress most messages and print to stdout.
Don\[cq]t create an output file.
Default behaviour if no filename given.
.PP
.TP
.B \fB-u\fR
Don\[cq]t sort output.
The sort is a simple bubble sort and very slow.
Large files are better to be sent to stdout and sorted through a command
line pipe.
.PP
.TP
.B \fB-v\fR
Verbose.
Print lots of stuff.
.PP
.TP
.B \fB-V\fR
Print version information.
.PP
.TP
.B \fB-x\fR
\fBExclude\fR entries in 'sf_filter' from file search.
.PP
.SS scheck
\fIscheck\fR searches for a single file in a database.  If no database is specified,
the last verified database is used.
.PP
.TP
.B \fB-d database-file\fR
Specify the database to search.  Databases should given with a full pathname to avoid 'not found' errors when the CWD changes.
.PP
.TP
.B \fB-V\fR
Print version information.
.PP
.SS sconvert
.PP
This converts a plain \fISHA256\fR file to a \fIs2db\fR file.
.PP
.SH FILES
.TP
.B sf_filter
File listing the names of files/directories in the current directory to
be included/excluded from the file search.
Can be generated with 'ls > sf_filter' and then edited as needed.
.TP
.B .scheck_db
File that stores the name of the last database file that \fIscheck\fR used sucessfully.
This database will be used until another is specified.
.TP
.B dataset.sha256
Two column (separated by two spaces) output from \fIsha256sum\fR.
.PP
.TP
.B dataset.s2db
Three column output, tab separated.
1: SHA256, 2: filepath, 3: dataset.
.PP
.SH RESTRICTIONS
.PP
The search in \fIsmatch\fR requires that the \fIsearchlist\fR is sorted by
SHA256.
If it isn\[cq]t already, \fIsmatch\fR will sort it.
The sort is slow.
As you\[cq]re likely to generate a dataset once but use it with \fIsmatch\fR
multiple times, \fIsfind\fR sorts by default.
That sort is also slow.
The search itself, however, is fast.
.SH DEPENDENCIES
.PP
\fIsfind\fR uses popen() to get SHA256SUMs - from \fIsha256sum\fR in Linux and \fIcertutil\fR in Windows.
.SH BUGS
.PP
The internal sort in \fIsmatch\fR fails when trying to sort a \fIsearchlist\fR with more than about 13000 lines.  So don't do that.
Doesn\[cq]t use zero-delimited file names, so is subject to errors caused by strange characters in file names, especially '\[ga]'.
Generally doesn\[cq]t get stuck in infinite loops; it just core dumps.
.SH COPYLEFT
.PP
If you want to steal this, I'll meet you in the carpark.
.SH AUTHOR
.PP
Bob Hayward (Zax) zx81\[at]zx81.nz
